<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Chat with System Controls</title>
  <link rel="stylesheet" href="/static/index.css">
</head>

<body>
  <div id="content">
    <div id="image">
      <img id="main_image" src="static/style/image.png" alt="main image">
      <div id="overlay"></div>
      <div id="chat_separator">&nbsp;</div>
      <div id="system-panel"></div>
    </div>
    <div id="chat"></div>
  </div>

  <script type="module">
    import { AvatarClient }             from '/scripts/client.js';
    import { Dispatcher }               from '/scripts/dispatcher.js';
    import { ChatHandler }              from '/scripts/chat-handler.js';
    import { ImageCommandHandler }      from '/scripts/image-handler.js';
    import { ButtonGridHandler }        from '/scripts/button-grid-handler.js';
    import { SystemButtonController }   from '/scripts/control-panel.js';
    import { Message }                  from '/scripts/message.js';

    const chatDiv     = document.getElementById('chat');
    const imageDiv    = document.getElementById('main_image');
    const overlayDiv  = document.getElementById('overlay');
    const panelDiv    = document.getElementById('system-panel');

    const client      = new AvatarClient(window.location.origin, 'default');
    initMessage = new Message('InitializationEvent');
    client.put(initMessage);
    client.lastMessageId = initMessage.envelop.id;

    const dispatcher  = new Dispatcher(client, 1);

    new ChatHandler(dispatcher, chatDiv, window.location.origin);
    new ImageCommandHandler(dispatcher, imageDiv);
    new ButtonGridHandler(dispatcher, overlayDiv, client);

    new SystemButtonController(imageDiv, panelDiv, overlayDiv, client);

    dispatcher.start();
  </script>
</body>
</html>
